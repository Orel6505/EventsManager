@using EventsManagerModels;

@model List<Hall>
@{
    ViewBag.Title = "Hall Management";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<link rel="stylesheet" href="~/Content/Styles/Menu.css" />
<link rel="stylesheet" href="~/Content/Styles/Admin.css" />
<script src="~/Scripts/jquery-3.7.1.js"></script>
<script src="~/Content/Scripts/Register.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
<div class="container">
    <div class="content">
        <main class="data">
            <div class="Menuwraper">
                <div class="foodWraper">
                    <button id="NewUserButton">New Hall</button>
                    <table id="HallsTable" class="rounded-table">
                        <thead class="OrdersTableHead">
                            <tr>
                                <th>HallId</th>
                                <th>Hall Name</th>
                                <th>Hall Description</th>
                                <th>Max People</th>
                                <th>Hall Image</th>
                                <th>Edit</th>
                            </tr>
                        </thead>
                        <tbody id="Halls" class="OrdersTableBody">
                            @if (Model.Count > 0)
                            {
                                foreach (Hall hall in Model)
                                {
                                    <tr>
                                        <td><h2 class="foodTitle">@hall.HallId</h2></td>
                                        <td><h4 class="foodTitle">@hall.HallName</h4></td>
                                        <td><h4 class="foodTitle">@hall.HallDesc</h4></td>
                                        <td><h4 class="foodTitle">@hall.MaxPeople</h4></td>
                                        <td><img class="foodImage" src="~/Content/Hall-img/@(hall.HallImage)" alt="@hall.HallName"></td>
                                        <td>
                                            <div class="icons">
                                                <span class="material-symbols-outlined icons updateHallButton" data-hallid="@hall.HallId">
                                                    edit
                                                </span>
                                                <span class="material-symbols-outlined icons">
                                                    delete
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td class="errorTitle" colspan="6"> Error 404, Please try later</td>
                                </tr>
                            }
                        </tbody>
                    </table>

                    <div id="hallModal" class="popup">
                        <div class="popup-content">
                            <span class="close">&times;</span>
                            <div class="wrapper base">
                                @using (Html.BeginForm("Halls", "Admin", FormMethod.Post, new { onsubmit = "return validateRegister()" }))
                                {
                                    <input type="hidden" id="HallId" name="HallId" />
                                    <input type="hidden" id="FormAction" name="FormAction" value="Register" />
                                    <ul>
                                        <li class="item cName">
                                            <label class="label">Hall Name</label><br>
                                            <input class="text" required type="text" id="HallName" name="HallName" />
                                        </li>
                                        <li class="item">
                                            <label class="label">Hall Description</label><br>
                                            <input class="text" required type="text" id="HallDesc" name="HallDesc" />
                                        </li>
                                        <li class="item">
                                            <label class="label">Max People</label><br>
                                            <input class="text" required type="number" id="MaxPeople" name="MaxPeople" />
                                        </li>
                                        <li class="item cButton">
                                            <button id="hallButton" class="button" type="submit" value="Register">Register</button>
                                        </li>
                                    </ul>
                                    @Html.AntiForgeryToken();
                                }
                                <p id="ResultLogin" />
                            </div>
                        </div>
                    </div>

                    <script>
                        var hallModal = document.getElementById("hallModal");
                        var newHallBtn = document.getElementById("NewHallButton");
                        var closeSpan = document.getElementsByClassName("close")[0];

                        newHallBtn.onclick = function () {
                            openModalForRegister();
                        }

                        closeSpan.onclick = function () {
                            hallModal.style.display = "none";
                        }

                        window.onclick = function (event) {
                            if (event.target == hallModal) {
                                hallModal.style.display = "none";
                            }
                        }

                        function openModalWithHallData(hallData) {
                            document.getElementById("HallId").value = hallData.id;
                            document.getElementById("HallName").value = hallData.hallName;
                            document.getElementById("HallDesc").value = hallData.hallDesc;
                            document.getElementById("MaxPeople").value = hallData.maxPeople;
                            document.getElementById("FormAction").value = "Update";
                            document.getElementById("hallButton").textContent = "Update";

                            hallModal.style.display = "block";
                        }

                        document.querySelectorAll(".updateHallButton").forEach(function (button) {
                            button.onclick = function () {
                                var row = this.closest('tr');
                                var cells = row.getElementsByTagName('td');

                                var hallData = {
                                    id: this.getAttribute('data-hallid'),
                                    hallName: cells[1].textContent,
                                    hallDesc: cells[2].textContent,
                                    maxPeople: cells[3].textContent,
                                };

                                openModalWithHallData(hallData);
                            };
                        });

                        function openModalForRegister() {
                            document.getElementById("HallId").value = "";
                            document.getElementById("HallName").value = "";
                            document.getElementById("HallDesc").value = "";
                            document.getElementById("MaxPeople").value = "";
                            document.getElementById("HallImage").value = "";
                            document.getElementById("FormAction").value = "Register";
                            document.getElementById("hallButton").textContent = "Register";

                            hallModal.style.display = "block";
                        }

                        closeSpan.onclick = function () {
                            hallModal.style.display = "none";
                        }

                        window.onclick = function (event) {
                            if (event.target == hallModal) {
                                hallModal.style.display = "none";
                            }
                        }
                    </script>
                </div>
            </div>
        </main>
    </div>
</div>
