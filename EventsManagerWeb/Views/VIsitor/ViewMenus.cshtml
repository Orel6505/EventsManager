@using EventsManagerModels;

@model MenuListVIewModel
@{
    ViewBag.Title = "ViewMenues";
    Layout = "~/Views/Master/MasterPage.cshtml";
}

@if (Model != null)
{
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.3.min.js"></script>
    <script>
        var MenuResponse;
        window.onload = function () {
            GetMenus();
            setInterval(GetMenus, 100000); // 100 seconds interval
        };
        function GetMenus() {
            const xhttp = new XMLHttpRequest();
            xhttp.onload = function () {
            try {
                globalThis.MenuResponse = JSON.parse(this.responseText);
                LoadMenus();
            } catch (error) {
                console.error("Error fetching menus:", error);
            }
            };
            xhttp.onerror = function () {
            console.error("Error during XHR request for menus.");
            };
            xhttp.open("GET", "@CommonParameters.Location.WebService/Visitor/GetMenus", true);
            xhttp.send();
        }
        function LoadMenus() {
            $("#MenusWrapper").empty();
            let ResultCouner = 0;
            let SearchVal = document.getElementById("MenuSearch").value ?? '';
            MenuResponse.Menus.forEach((menu) => {
            if (SearchVal !== null) { // strict not-equal operator
                if (menu.MenuName.includes(SearchVal)) {
                    $("#MenusWrapper").append('<div id="MenuItem">' +
                        '<a href="@CommonParameters.Location.WebServer/ViewMenu/?id=' + menu.MenuId + '">' + menu.MenuName + '</a>' +
                        '</div>');
                    ResultCouner++;
                }
            } else {
                $("#MenusWrapper").append('<div id="MenuItem">' +
                '<a href="@CommonParameters.Location.WebServer/ViewMenu/?id=' + menu.MenuId + '">' + menu.MenuName + '</a>' +
                '</div>');
            }
            });
            if (!ResultCouner && SearchVal) {
                $("#MenusWrapper").append('<div id="MenuItem">' + 'לא נמצאו תפריטים עם השם הזה.' + '</div>');
            }
        }
    </script>
    <input type="search" id="MenuSearch" name="MenuSearch">
    <script>
        const el = document.getElementById("MenuSearch");
        el.addEventListener('input', LoadMenus);
    </script>
    <div id="MenusWrapper"></div>
}
else
{
    <section class="errorSection">
        <h1 class="errorTitle">There was a connection issue. Please try later later</h1>
    </section>
}